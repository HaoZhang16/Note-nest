<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>ä¹¦åº“</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/library.css') }}">
</head>
<body>
    <h2>ğŸ“– æ‰€æœ‰ä¹¦ç±</h2>

    <div class="book-grid">
        {% for book in books %}
            <div class="book-card" data-in-read="{{ 'true' if book.book_id in in_read_books else 'false' }}">
                <img src="{{ url_for('static', filename=book.cover_path or 'covers/default_cover.jpg') }}"
                     class="book-cover">

                <div class="book-title">{{ book.title }}</div>
                <div class="book-author">ä½œè€…ï¼š{{ book.author or 'æœªçŸ¥ä½œè€…' }}</div>
                {% if book.total_page %}
                    <div class="book-pages">é¡µæ•°ï¼š{{ book.total_page }}</div>
                {% endif %}
                <div class="book-status">
                    {% if book.book_id in in_read_books %}
                        âœ… å·²åœ¨è¯»
                    {% else %}
                        <form action="/mark_in_read" method="post">
                            <input type="hidden" name="book_id" value="{{ book.book_id }}">
                            <button type="submit">ğŸ“Œ æ ‡è®°åœ¨è¯»</button>
                        </form>
                    {% endif %}
                </div>
                <div>
                    <a class="back-link" href="/book/{{ book.book_id }}/notes">ç›¸å…³ç¬”è®°</a>
                </div>
            </div>
        {% endfor %}
    </div>

    <a class="back-link" href="/home">â† è¿”å›ä¸»é¡µ</a>

    <div class="filter-checkbox">
        <label>
            <input type="checkbox" id="is_in_read" name="is_in_read">
            åªçœ‹åœ¨è¯»çš„ä¹¦
        </label>
    </div>

    <script>
        const checkbox = document.getElementById("is_in_read");
        checkbox.addEventListener("change", () => {
            const inReadOnly = checkbox.checked;
            document.querySelectorAll(".book-card").forEach(card => {
                const isInRead = card.dataset.inRead === "true";
                card.style.display = (!inReadOnly || isInRead) ? "flex" : "none";
            });
        });
    </script>
</body>
</html>
